<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brochure Orders | Louisiana Travel Association</title>
    
    <!-- Fonts (unchanged) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- GlueUp (unchanged) -->
    <script src='https://app.glueup.com/compiled/js/eb-widgets.min.js' type='text/javascript'></script>

    <!-- Your site styles (unchanged) -->
    <style>
        :root {
            --primary: #004b87; 
            --secondary: #f15a24;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --bg-color: #f8fafc; 
            --card-bg: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
        }

        header {
            background-color: var(--card-bg);
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.75rem 2rem;
        }

        .logo img {
            height: 60px;
            width: auto;
            display: block;
        }

        .hero {
            width: 100%;
            display: flex;
            justify-content: center;
            background: linear-gradient(180deg, #ffffff 0%, #f1f5f9 100%);
            padding-bottom: 2rem;
        }

        .hero-banner {
            width: 100%;
            max-width: 1200px;
            height: auto;
            display: block;
            border-radius: 0 0 16px 16px;
        }

        .container {
            max-width: 1000px;
            margin: -2rem auto 4rem;
            padding: 0 1.5rem;
            position: relative;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid #f1f5f9;
        }

        .info-section h2, .card h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.75rem;
        }

        .highlight { color: var(--secondary); font-weight: 600; }

        /* Floorplan Specific Styling */
        .floorplan-iframe {
            position: relative;
            width: 100%;
            height: 720px; 
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .eb-widget {
            width: 100%;
            min-height: 900px; 
            border: 0;
            display: block;
            background: transparent;
        }

        footer {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        @media (max-width: 920px) {
            .floorplan-iframe { height: 560px; }
            .container { margin-top: 1rem; }
            .card { padding: 1.5rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="#" class="logo">
                <img src="Website-Header-2025-NEW-LTA-LOGO-horizontal_2.webp" alt="LTA Logo">
            </a>
        </div>
    </header>

    <div class="hero">
        <img src="designer.png" alt="LTA Banner" class="hero-banner">
    </div>

    <div class="container">
        <div class="card info-section">
            <h2>Order Your Monthly Brochures</h2>
            <p>As a valued member of the <span class="highlight">Louisiana Travel Association</span>, you can request unlimited brochures every month at no cost.</p>
            <p style="margin-top: 1rem; font-size: 0.95rem; color: var(--text-muted);">Use the interactive floorplan below to locate specific tourism regions before placing your order.</p>
        </div>

        <!-- =================== Brochure Order (Stock + Shipping + Tracking) =================== -->
        <section id="brochure-order" class="container">
          <h2>Select Free Brochures</h2>

          <!-- Controls -->
          <div class="controls">
            <input id="search" type="search" placeholder="Search by title or code…" />
            <select id="region-filter">
              <option value="">All regions</option>
            </select>
            <button id="clear-cart" type="button">Clear Cart</button>
          </div>

          <!-- Catalog -->
          <div id="catalog"></div>

          <!-- Order summary + Shipping -->
          <aside id="cart">
            <h3>Your Order</h3>
            <div id="cart-items" aria-live="polite"></div>

            <h4 style="margin-top:1rem;">Shipping</h4>
            <div class="grid2">
              <label>Full name
                <input id="ship-name" autocomplete="name" />
              </label>
              <label>Email
                <input id="customer-email" type="email" placeholder="you@example.com" autocomplete="email" />
              </label>
              <label>Address line 1
                <input id="ship-addr1" autocomplete="address-line1" />
              </label>
              <label>Address line 2
                <input id="ship-addr2" autocomplete="address-line2" />
              </label>
              <label>City
                <input id="ship-city" autocomplete="address-level2" />
              </label>
              <label>State
                <input id="ship-state" autocomplete="address-level1" />
              </label>
              <label>Postal Code
                <input id="ship-zip" autocomplete="postal-code" />
              </label>
              <label>Country
                <input id="ship-country" value="USA" />
              </label>
            </div>

            <label>Notes (optional)
              <textarea id="order-notes" rows="3" placeholder="Delivery details, special instructions…"></textarea>
            </label>

            <div class="cart-footer" style="margin-top: 0.75rem;">
              <button id="submit-order" type="button">Submit Order</button>
              <div class="muted" id="order-id-wrap" hidden>Order ID: <span id="order-id"></span></div>
            </div>
          </aside>

          <!-- Public tracking lookup -->
          <div id="tracking-lookup" class="tracker">
            <h3>Track Your Order</h3>
            <div class="row">
              <input id="lookup-id" placeholder="Enter Order ID (e.g., LTA-20260130-123456)" />
              <button id="lookup-btn" type="button">Lookup</button>
            </div>
            <div id="lookup-result" aria-live="polite"></div>
          </div>
        </section>

        <!-- Widget-only minimal styles (kept light to preserve your design) -->
        <style>
          #brochure-order { display: grid; grid-template-columns: 3fr 1fr; gap: 2rem; }
          #catalog { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
          .controls { grid-column: 1 / -1; display: flex; gap: 1rem; align-items: center; margin-bottom: .5rem; }
          .region-title { grid-column: 1 / -1; margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: .75rem; font-size: 1.25rem; }
          .card { border: 1px solid #e5e5e5; border-radius: 8px; padding: .75rem; display: flex; flex-direction: column; gap: .5rem; background: #fff; }
          .code { font-weight: 600; color: #555; }
          .title { font-size: .98rem; line-height: 1.3; }
          .stock { font-size: .88rem; color: #666; }
          .out { color: #b00020; font-weight: 600; }
          .qty { display: flex; gap: .5rem; align-items: center; margin-top: auto; }
          .qty input { width: 80px; }
          #cart { position: sticky; top: 1rem; border: 1px solid #e5e5e5; border-radius: 8px; padding: 1rem; background: #fafafa; height: fit-content; }
          #cart-items { display: grid; gap: .5rem; margin-bottom: 1rem; }
          .cart-row { display: grid; grid-template-columns: auto 70px auto; gap: .5rem; align-items: center; }
          .muted { color: #888; }
          .grid2 { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: .75rem; margin: .5rem 0 1rem; }
          .tracker { grid-column: 1 / -1; border: 1px solid #e5e5e5; border-radius: 8px; padding: 1rem; background: #fff; }
          .tracker .row { display: flex; gap: .5rem; margin-bottom: .5rem; }
          @media (max-width: 900px) {
            #brochure-order { grid-template-columns: 1fr; }
            #cart { order: -1; }
            .grid2 { grid-template-columns: 1fr; }
          }
        </style>

        <script>
        (async function init() {
          const catalogEl = document.getElementById('catalog');
          const regionFilterEl = document.getElementById('region-filter');
          const searchEl = document.getElementById('search');
          const cartItemsEl = document.getElementById('cart-items');
          const clearCartBtn = document.getElementById('clear-cart');
          const submitBtn = document.getElementById('submit-order');

          const notesEl = document.getElementById('order-notes');
          const emailEl = document.getElementById('customer-email');

          // Shipping fields
          const nameEl = document.getElementById('ship-name');
          const addr1El = document.getElementById('ship-addr1');
          const addr2El = document.getElementById('ship-addr2');
          const cityEl  = document.getElementById('ship-city');
          const stateEl = document.getElementById('ship-state');
          const zipEl   = document.getElementById('ship-zip');
          const countryEl = document.getElementById('ship-country');

          // Order ID UI
          const orderIdWrap = document.getElementById('order-id-wrap');
          const orderIdEl = document.getElementById('order-id');

          // Tracking lookup UI
          const lookupIdEl = document.getElementById('lookup-id');
          const lookupBtn = document.getElementById('lookup-btn');
          const lookupResultEl = document.getElementById('lookup-result');

          // Fetch catalog + stock. If stock.csv is missing, treat as "unlimited" so items remain orderable.
          let stockMap = null;
          const catalog = await fetch('brochures.json', { cache: 'no-store' }).then(r => r.json());
          try {
            const text = await fetch('stock.csv', { cache: 'no-store' }).then(r => r.ok ? r.text() : Promise.reject());
            stockMap = parseStockCSV(text); // Map(code -> number)
          } catch { stockMap = null; } // no stock.csv => available

          // Regions (input order)
          const regions = [...new Set(catalog.map(x => x.region))];
          regions.forEach(r => {
            const opt = document.createElement('option');
            opt.value = r; opt.textContent = r;
            regionFilterEl.appendChild(opt);
          });

          // In-memory cart
          const cart = new Map();

          function renderCatalog() {
            const q = searchEl.value.trim().toLowerCase();
            const region = regionFilterEl.value;

            const byRegion = new Map();
            for (const item of catalog) {
              if (region && item.region !== region) continue;
              if (q) {
                const t = `${item.code} ${item.title}`.toLowerCase();
                if (!t.includes(q)) continue;
              }
              if (!byRegion.has(item.region)) byRegion.set(item.region, []);
              byRegion.get(item.region).push(item);
            }

            catalogEl.innerHTML = '';
            for (const [reg, items] of byRegion) {
              const h = document.createElement('h4');
              h.className = 'region-title';
              h.textContent = reg;
              catalogEl.appendChild(h);

              for (const it of items) {
                // If stockMap is null => unlimited. If code not in map => unlimited.
                const hasManagedStock = stockMap instanceof Map && stockMap.has(it.code);
                const stock = hasManagedStock ? stockMap.get(it.code) : null;

                const card = document.createElement('div');
                card.className = 'card';

                const code = document.createElement('div');
                code.className = 'code';
                code.textContent = `#${it.code}`;

                const title = document.createElement('div');
                title.className = 'title';
                title.textContent = it.title;

                const stockRow = document.createElement('div');
                stockRow.className = 'stock';
                if (hasManagedStock) {
                  stockRow.innerHTML = stock > 0 ? `In stock: <strong>${stock}</strong>` : `<span class="out">Out of stock</span>`;
                } else {
                  stockRow.textContent = 'Available';
                }

                const qtyWrap = document.createElement('div');
                qtyWrap.className = 'qty';
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '0';
                input.step = '1';
                input.value = cart.get(it.code)?.qty ?? 0;

                // Enforce stock only if managed
                if (hasManagedStock) {
                  if (stock > 0) input.max = String(stock);
                  input.disabled = stock <= 0;
                }

                const addBtn = document.createElement('button');
                addBtn.textContent = 'Add';
                if (hasManagedStock) addBtn.disabled = stock <= 0;

                addBtn.addEventListener('click', () => {
                  let qty = Math.max(0, parseInt(input.value || '0', 10));
                  if (hasManagedStock) {
                    if (qty > stock) qty = stock;
                    input.value = qty;
                  }
                  if (qty > 0) cart.set(it.code, { item: it, qty, stock: hasManagedStock ? stock : null });
                  else cart.delete(it.code);
                  renderCart();
                });

                qtyWrap.append('Qty:', input, addBtn);
                card.append(code, title, stockRow, qtyWrap);
                catalogEl.appendChild(card);
              }
            }

            if (catalogEl.innerHTML.trim() === '') {
              catalogEl.innerHTML = `<p class="muted">No brochures match your filters.</p>`;
            }
          }

          function renderCart() {
            cartItemsEl.innerHTML = '';
            if (cart.size === 0) {
              cartItemsEl.innerHTML = `<p class="muted">Your cart is empty.</p>`;
              return;
            }
            for (const { item, qty } of cart.values()) {
              const row = document.createElement('div');
              row.className = 'cart-row';
              const title = document.createElement('div');
              title.textContent = `${item.title} (#${item.code})`;
              const qtyEl = document.createElement('div');
              qtyEl.textContent = `x${qty}`;
              const rm = document.createElement('button');
              rm.type = 'button';
              rm.textContent = 'Remove';
              rm.addEventListener('click', () => {
                cart.delete(item.code);
                renderCatalog();
                renderCart();
              });
              row.append(title, qtyEl, rm);
              cartItemsEl.appendChild(row);
            }
          }

          // Tracking lookup
          document.getElementById('lookup-btn').addEventListener('click', async () => {
            const id = (lookupIdEl.value || '').trim();
            if (!id) return;
            try {
              const text = await fetch('shipments.csv', { cache: 'no-store' }).then(r => r.text());
              const rows = parseCSV(text);
              const header = rows[0] || [];
              const idx = header.reduce((m, k, i) => (m[k] = i, m), {});
              const match = rows.slice(1).find(r => (r[idx.orderId] || '').trim() === id);
              if (!match) {
                lookupResultEl.innerHTML = `<p class="muted">No record found for ${id}.</p>`;
                return;
              }
              const status = match[idx.status] || 'Pending';
              const carrier = match[idx.carrier] || '';
              const tracking = match[idx.trackingNumber] || '';
              const shipDate = match[idx.shipDate] || '';
              const note = match[idx.notes] || '';

              let html = `<p><strong>Status:</strong> ${status}</p>`;
              if (tracking) html += `<p><strong>Tracking #:</strong> ${tracking} ${carrier ? '(' + carrier + ')' : ''}</p>`;
              if (shipDate) html += `<p><strong>Ship date:</strong> ${shipDate}</p>`;
              if (note) html += `<p><strong>Notes:</strong> ${note}</p>`;
              lookupResultEl.innerHTML = html;
            } catch {
              lookupResultEl.innerHTML = `<p class="muted">Could not load tracking data right now.</p>`;
            }
          });

          // Wire controls
          [searchEl, regionFilterEl].forEach(el => el.addEventListener('input', renderCatalog));
          clearCartBtn.addEventListener('click', () => { cart.clear(); renderCatalog(); renderCart(); });

          // Submit handler (email or webhook)
          submitBtn.addEventListener('click', () => {
            // Validate
            const email = (emailEl.value || '').trim();
            const name  = (nameEl.value || '').trim();
            const addr1 = (addr1El.value || '').trim();
            const city  = (cityEl.value || '').trim();
            const state = (stateEl.value || '').trim();
            const zip   = (zipEl.value || '').trim();
            const country = (countryEl.value || '').trim() || 'USA';

            if (cart.size === 0) { alert('Your cart is empty.'); return; }
            if (!name || !addr1 || !city || !state || !zip) { alert('Please complete the shipping address.'); return; }

            // Order ID: YYYYMMDD-HHMMSS
            const now = new Date();
            const pad = n => n.toString().padStart(2,'0');
            const orderId = `LTA-${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}${pad(now.getSeconds())}`;

            orderIdWrap.hidden = false;
            orderIdEl.textContent = orderId;

            // Mail body (includes CSV row for shipments.csv)
            const notes = (notesEl.value || '').trim();
            const lines = [];
            lines.push(`Brochure Order — ${orderId}`);
            lines.push('-----------------------------------------');
            if (email) lines.push(`Customer email: ${email}`);
            lines.push(`Ship to: ${name}`);
            lines.push(`${addr1}`);
            const addr2 = (addr2El.value || '').trim();
            if (addr2) lines.push(addr2);
            lines.push(`${city}, ${state} ${zip}`);
            lines.push(`${country}`);
            if (notes) lines.push(`Notes: ${notes}`);
            lines.push('');
            lines.push('Items:');
            for (const { item, qty } of cart.values()) {
              lines.push(`#${item.code} — ${item.title}  x${qty}`);
            }
            lines.push('');
            lines.push('--- Paste this row into shipments.csv after creating the shipment ---');
            lines.push('orderId,customerEmail,name,address1,address2,city,state,postalCode,country,status,carrier,trackingNumber,shipDate,notes,updatedAt');
            lines.push(`${orderId},${email},${name},${addr1},${addr2},${city},${state},${zip},${country},Pending,,,,"${notes.replaceAll('"','\"')}",${new Date().toISOString()}`);

            const body = encodeURIComponent(lines.join('\n'));
            const subject = encodeURIComponent(`Brochure Order ${orderId}`);
            // TODO: change the inbox below to the client’s order email
            window.location.href = `mailto:orders@yourclient.org?subject=${subject}&body=${body}`;

            // Webhook option (disabled by default)
            // fetch('https://YOUR-WEBHOOK-URL', {
            //   method: 'POST',
            //   headers: { 'Content-Type': 'application/json' },
            //   body: JSON.stringify({
            //     orderId, email, name,
            //     address1: addr1, address2: addr2, city, state, postalCode: zip, country,
            //     notes,
            //     items: [...cart.values()].map(({item, qty}) => ({ code: item.code, title: item.title, qty, region: item.region }))
            //   })
            // }).then(() => alert('Order submitted!')).catch(() => alert('Submission failed'));
          });

          // Initial render
          renderCatalog();
          renderCart();

          // Helpers
          function parseStockCSV(text) {
            // Returns Map(code -> stock#). If fails, caller will treat as unlimited.
            const rows = parseCSV(text);
            const header = rows[0] || [];
            const idx = header.reduce((m, k, i) => (m[k] = i, m), {});
            const map = new Map();
            for (const r of rows.slice(1)) {
              const code = (r[idx.code] || '').trim();
              const s = parseInt(r[idx.stock] || '0', 10);
              if (code) map.set(code, isNaN(s) ? 0 : s);
            }
            return map;
          }

          function parseCSV(text) {
            const lines = text.replace(/\r/g, '').split('\n').filter(Boolean);
            return lines.map(line => {
              const out = [];
              let cur = '', inQuotes = false;
              for (let i = 0; i < line.length; i++) {
                const ch = line[i];
                if (ch === '"') {
                  if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
                  else inQuotes = !inQuotes;
                } else if (ch === ',' && !inQuotes) {
                  out.push(cur); cur = '';
                } else {
                  cur += ch;
                }
              }
              out.push(cur);
              return out;
            });
          }
        })();
        </script>
        <!-- =================== /Brochure Order =================== -->

        <!-- =================== Exhibit Floorplan (unchanged) =================== -->
        <section class="card" id="floorplan" aria-label="Exhibit floorplan">
            <h2>Exhibit Floorplan</h2>
            <div class="floorplan-iframe">
                <iframe
                    title="FHEA 2026 Floorplan"
                    src="https://homebase.map-dynamics.com/fhea2026/floorplan"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    style="display:block; width:100%; height:100%; border:0;">
                </iframe>
            </div>
        </section>
        <!-- =================== /Exhibit Floorplan =================== -->

        <div class="card">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2>Member Registration Store</h2>
            </div>

            <iframe 
                class="eb-widget" 
                id="eb-widget-event-registration" 
                name="eb-widget-event-registration" 
                data-auto-adjust-height="true" 
                src="https://glueupna.glueup.com/organization/4582/widget/event-registration/?lang=en&eventID=168286">
            </iframe>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Louisiana Travel Association. All rights reserved.</p>
    </footer>

</body>
</html>
